# AiNiee 句子分割功能说明

## 概述

为AiNiee项目新增了智能句子分割功能，支持按句子而非按行来处理txt文档，提供更精细的翻译控制。

## 新增文件

### 1. SentenceSplitter.py
**位置**: `ModuleFolders/TextProcessor/SentenceSplitter.py`

**功能**: 智能句子分割器，支持多语言文本的句子识别和分割

**主要特性**:
- 支持中文、英文、日文的句子分割
- 智能识别句子结束标点符号
- 处理英文缩写词，避免误分割
- 支持引号和括号内容的完整性保护
- 提供智能分割功能（合并短句、分割长句）

**核心方法**:
```python
# 基础句子分割
sentences = splitter.split_into_sentences(text)

# 智能分割（推荐使用）
smart_sentences = splitter.smart_split(text, max_length=200, min_length=10)

# 按行和句子混合分割
line_sentences = splitter.split_by_lines_and_sentences(text)
```

### 2. TxtSentenceReader.py
**位置**: `ModuleFolders/FileReader/TxtSentenceReader.py`

**功能**: 支持按句子分割的TXT文件读取器

**主要特性**:
- 兼容原有的按行分割模式
- 新增按句子分割模式
- 可配置最大/最小句子长度
- 保留原始格式信息用于还原

**使用方法**:
```python
# 按行模式（传统方式）
line_reader = TxtSentenceReader(input_config, sentence_mode=False)

# 按句子模式（新功能）
sentence_reader = TxtSentenceReader(
    input_config, 
    sentence_mode=True,
    max_sentence_length=200,
    min_sentence_length=10
)
```

### 3. test_sentence_splitter.py
**位置**: `test_sentence_splitter.py`

**功能**: 句子分割功能的测试和演示脚本

## 功能特点

### 1. 多语言支持
- **中文**: 识别句号(。)、感叹号(！)、问号(？)、分号(；)、省略号(…)
- **英文**: 识别句号(.)、感叹号(!)、问号(?)、分号(;)，同时处理缩写词
- **日文**: 识别日文标点符号
- **混合文本**: 自动检测语言并应用相应规则

### 2. 智能处理
- **缩写词保护**: 避免在Dr.、U.S.A.等缩写词处误分割
- **数字保护**: 避免在小数点处分割（如3.14）
- **引号配对**: 保持引号内容的完整性
- **长句分割**: 自动在逗号、连词等处分割过长句子
- **短句合并**: 将过短的句子合并以提高翻译质量

### 3. 格式保持
- **空行保留**: 记录并保持原文的空行结构
- **换行信息**: 保存换行符类型和位置
- **位置信息**: 记录每个句子在原文中的位置
- **行号映射**: 维护句子与原始行号的对应关系

## 使用场景

### 1. 适合按句子分割的文本类型
- **小说、故事**: 保持叙述的连贯性
- **技术文档**: 确保概念的完整性
- **新闻文章**: 保持信息的逻辑性
- **学术论文**: 维护论述的严谨性

### 2. 仍建议按行分割的文本类型
- **诗歌**: 行结构具有特殊意义
- **代码注释**: 行对应代码结构
- **列表项目**: 每行是独立项目
- **表格数据**: 行列结构重要

## 配置参数

### SentenceSplitter参数
- 无需配置，自动检测语言并应用相应规则

### TxtSentenceReader参数
- `sentence_mode`: 是否启用句子分割模式（默认False）
- `max_sentence_length`: 最大句子长度（默认200字符）
- `min_sentence_length`: 最小句子长度（默认10字符）

## 性能对比

### 按行分割 vs 按句子分割

| 特性 | 按行分割 | 按句子分割 |
|------|----------|------------|
| 处理单元 | 文本行 | 完整句子 |
| 翻译质量 | 可能断句 | 语义完整 |
| 上下文 | 行级别 | 句子级别 |
| 格式保持 | 完美 | 良好 |
| 处理速度 | 快 | 稍慢 |
| 适用场景 | 结构化文本 | 自然语言文本 |

## 实际效果示例

### 原始文本
```
这是第一段文本。包含两个句子！

这是第二段文本。它也包含多个句子？还有一些标点符号。
```

### 按行分割结果（4个翻译单元）
1. "这是第一段文本。包含两个句子！"
2. "这是第二段文本。它也包含多个句子？还有一些标点符号。"

### 按句子分割结果（6个翻译单元）
1. "这是第一段文本。"
2. "包含两个句子！"
3. "这是第二段文本。"
4. "它也包含多个句子？"
5. "还有一些标点符号。"

## 集成方式

### 1. 在现有项目中使用
```python
# 导入新的读取器
from ModuleFolders.FileReader.TxtSentenceReader import TxtSentenceReader

# 替换原有的TxtReader
# 原来: reader = TxtReader(input_config)
# 现在: reader = TxtSentenceReader(input_config, sentence_mode=True)
```

### 2. 配置选项建议
- 对于小说、文章等自然语言文本：启用句子模式
- 对于代码、配置文件等结构化文本：保持行模式
- 可以提供用户界面选项让用户选择分割模式

## 测试和验证

运行测试脚本验证功能：
```bash
python test_sentence_splitter.py
```

测试内容包括：
1. 句子分割器的基本功能测试
2. 多语言文本处理测试
3. TXT文件读取器对比测试
4. 统计信息验证

## 注意事项

1. **兼容性**: 新功能完全向后兼容，不影响现有功能
2. **性能**: 句子分割会增加少量处理时间，但提升翻译质量
3. **内存**: 句子模式可能产生更多翻译单元，需要更多内存
4. **配置**: 建议根据文本类型选择合适的分割模式

## 未来扩展

1. **更多语言支持**: 可扩展支持更多语言的句子分割规则
2. **自定义规则**: 允许用户定义特殊的分割规则
3. **智能模式选择**: 自动检测文本类型并选择最佳分割模式
4. **批量处理优化**: 针对大文件的性能优化

## 总结

句子分割功能为AiNiee项目提供了更精细的文本处理能力，特别适合处理自然语言文本。通过智能的句子识别和分割，可以显著提升翻译质量，同时保持良好的格式兼容性。用户可以根据具体需求选择最适合的分割模式。
